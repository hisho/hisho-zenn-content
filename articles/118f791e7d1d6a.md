---
title: "graphql-requestã®ã‚¨ãƒ©ãƒ¼ã®å‹ãŒåˆ†ã‹ã‚‰ãªã„"
emoji: "ğŸ¤”"
type: "tech"
topics: ["typescript", "graphql"]
published: true
---

Next.js v13ã§GraphQLã‚’promiseã§ä½¿ã†ãŸã‚ã«`graphql-request`ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã‚¨ãƒ©ãƒ¼ã®å‹ãŒåˆ†ã‹ã‚‰ãªã‹ã£ãŸã®ã§ãƒ¡ãƒ¢ã€‚
`typed-document-node`ã§è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚

```tsx:graphql-request
const Component = () => {
  
  const handleMutate = async () => {
    try {
      await new GraphQLClient('').request(HogeDocument).catch((e) => {
        e // any
      })
    } catch (e) {
      e // unknown
    }
  }
}
```

## URQL
`CombinedError`ã‚’ä½¿ã£ã¦åˆ¤å®šãŒå¯èƒ½ã€‚   
è¿”ã‚Šå€¤ã«`error`ãŒå«ã¾ã‚Œã‚‹ã®ã§`catch`ã§ã‚­ãƒ£ãƒƒãƒã™ã‚‹å¿…è¦ã¯ãªã„ã€‚
https://formidable.com/open-source/urql/docs/api/core/#combinederror

```tsx:URQL
const Component = () => {
  const [,muattion] = useMutation(HogeDocument)

  const handleMutate = async () => {
    try {
      const { error } = await mutate()
      if (error) {
        error.graphQLErrors // GraphQLError[] 
      }
    } catch (e) {
      console.log(e) // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼
    }
  }
}
```

## Apollo Client

`ApolloError`ã‚’ä½¿ã£ã¦åˆ¤å®šãŒå¯èƒ½ã€‚
è¿”ã‚Šå€¤ã«`error`ã‚’å«ã‚€ã—`catch`ã§ã‚‚å–å¾—ã§ãã‚‹ã€‚
https://github.com/apollographql/apollo-client/blob/main/src/errors/index.ts#L44

```tsx:Apollo Client
const Component = () => {
  const [mutate] = useMutation(HogeDocument)
  
  const handleMutate = async () => {
    try {
      const { error } = await mutate()
      if(errors) {
        errors  // ReadonlyArray<GraphQLError>
      }
    } catch (e) {
      if (e instanceof ApolloError) {
        e.graphQLErrors // ReadonlyArray<GraphQLError>
      }
    }
  }
}
```

## graphql-request

GraphQLã®ã‚¨ãƒ©ãƒ¼ã¯`200`ã§è¿”ã£ã¦ãã‚‹ã®ã«`catch`ã§ãã‚‹ã®ã§ä½•ã‹ã—ã‚‰ã‚¨ãƒ©ãƒ¼ã®åŠ å·¥ã‚’ã—ã¦ã„ã‚‹ã£ã½ã„ã€‚

https://github.com/prisma-labs/graphql-request#error-handling
https://github.com/prisma-labs/graphql-request/blob/master/examples/error-handling.ts#L23-L26
ã—ã‹ã—ã€å…¬å¼ã®`Error handling`ã®é …ç›®ã‚’è¦‹ã¦ã‚‚`console.error(JSON.stringify(error, undefined, 2))`ã¨ã—ã‹æ›¸ã„ã¦ãŠã‚‰ãšã€å‹ãŒåˆ†ã‹ã‚‰ãªã„ã€‚

`src/types.ts`ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€`GraphQLResponse`ã®`error`ã®å‹ãŒ`GraphQLError`ã¨ãªã£ã¦ã„ã‚‹ã€‚
https://github.com/prisma-labs/graphql-request/blob/c17f82138e5c0e7960fd1fb2ba9ef439323d57dc/src/types.ts#L14-L20

ã“ã®`GraphQLResponse`ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ç®‡æ‰€ã‚’æ¢ã™ã¨`ClientError`ã«ãŸã©ã‚Šç€ã„ãŸã®ã§ã€`ClientError`ã®`instanceof`ã§åˆ¤å®šã™ã‚‹ã¨ã»ã—ã„å‹ãŒæ‰‹ã«å…¥ã‚Šãã†ã ã£ãŸã€‚
https://github.com/prisma-labs/graphql-request/blob/master/src/types.ts#L27-L28

```tsx
const Component = () => {
  
  const handleMutate = async () => {
    try {
      await new GraphQLClient('').request(HogeDocument).catch((e) => {
        if (e instanceof ClientError) {
          e.response.errors // GraphQLError[] | undefined
        }
      })
    } catch (e) {
      if (e instanceof ClientError) {
        e.response.errors // GraphQLError[] | undefined
      }
    }
  }
}
```

`error`ã‚’`ClientError`ã®`instanceof`ã§åˆ¤å®šã—ãŸå¾Œã€`e.response.errors`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨`GraphQLError[]`or`undefined`ãŒå–å¾—ã§ãã‚‹ã€‚